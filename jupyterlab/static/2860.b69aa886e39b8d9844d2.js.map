{"version":3,"sources":["webpack://@jupyterlab/application-top/./node_modules/leaflet-search/dist/leaflet-search.src.js"],"names":["factory","L","Control","Search","extend","includes","version","Evented","prototype","Mixin","Events","options","url","layer","sourceData","jsonpParam","propertyLoc","propertyName","formatData","filterData","moveToLocation","buildTip","container","zoom","minLength","initial","casesensitive","autoType","delayType","tooltipLimit","tipAutoSubmit","firstTipSubmit","autoResize","collapsed","autoCollapse","autoCollapseTime","textErr","textCancel","textPlaceholder","hideMarkerOnCollapse","position","marker","icon","animate","circle","radius","weight","color","stroke","fill","_getPath","obj","prop","parts","split","last","pop","len","length","cur","i","_isObject","Object","toString","call","initialize","Util","setOptions","this","_inputMinSize","_layer","LayerGroup","_filterData","_defaultFilterData","_formatData","_defaultFormatData","_moveToLocation","_defaultMoveToLocation","_autoTypeTmp","_countertips","_recordsCache","_curReq","onAdd","map","_map","_container","DomUtil","create","_input","_createInput","_tooltip","_createTooltip","_cancel","_createCancel","_button","_createButton","_alert","_createAlert","expand","Marker","CircleMarker","_markerSearch","_isMarkerSearch","setLayer","on","_handleAutoresize","addTo","_wrapper","get","style","appendChild","onRemove","off","showAlert","text","self","display","innerHTML","clearTimeout","timerAlert","setTimeout","hideAlert","cancel","value","_handleKeypress","keyCode","size","focus","_hideTooltip","fire","toggle","addClass","collapse","blur","removeClass","removeLayer","collapseDelayed","timerCollapse","collapseDelayedStop","className","alert","DomEvent","stop","label","input","type","autocomplete","autocorrect","autocapitalize","placeholder","role","id","htmlFor","disableClickPropagation","e","title","href","button","_handleSubmit","tool","stopPropagation","_createTip","val","tip","tmpNode","firstChild","_text","_getUrl","records","I","icase","regSearch","frecords","replace","undefined","RegExp","key","test","showTooltip","currentSelection","_autoType","scrollTop","json","propName","propLoc","jsonret","isArray","latLng","_recordsFromJsonp","callAfter","callJsonp","script","document","getElementsByTagName","template","s","src","abort","parentNode","removeChild","_recordsFromAjax","window","XMLHttpRequest","ActiveXObject","e1","e2","Error","IE8or9","Browser","ie","atob","querySelector","request","XDomainRequest","open","onload","JSON","parse","responseText","onreadystatechange","readyState","status","send","_searchInLayer","retRecords","loc","getLatLng","feature","properties","Path","Polyline","Polygon","getBounds","getCenter","hasOwnProperty","eachLayer","_recordsFromLayer","start","firstRecord","end","indexOf","createTextRange","selRange","moveStart","moveEnd","select","setSelectionRange","selectionStart","selectionEnd","_hideAutoType","sel","selection","empty","getSelection","removeAllRanges","_handleArrowSelect","timerKeypress","_fillRecordsCache","searchText","code","charCodeAt","inputText","_retrieveData","data","maxWidth","offsetWidth","clientWidth","velocity","searchTips","hasChildNodes","childNodes","tipOffsetTop","offsetTop","clientHeight","_getLocation","showLocation","latlng","setView","panTo","once","setLatLng","Icon","Default","_circleLoc","addLayer","_initIcon","_removeIcon","tInt","ss","mr","parseInt","_radius","oldrad","newrad","acc","_timerAnimLoc","setInterval","setRadius","clearInterval","Map","addInitHook","searchControl","control","search","addControl"],"mappings":"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","file":"2860.b69aa886e39b8d9844d2.js?v=b69aa886e39b8d9844d2","sourcesContent":["/* \n * Leaflet Control Search v2.9.9 - 2020-12-01 \n * \n * Copyright 2020 Stefano Cudini \n * stefano.cudini@gmail.com \n * http://labs.easyblog.it/ \n * \n * Licensed under the MIT license. \n * \n * Demo: \n * http://labs.easyblog.it/maps/leaflet-search/ \n * \n * Source: \n * git@github.com:stefanocudini/leaflet-search.git \n * \n */\n/*\n\tName\t\t\t\t\tData passed\t\t\t   Description\n\n\tManaged Events:\n\t search:locationfound\t{latlng, title, layer} fired after moved and show markerLocation\n\t search:expanded\t\t{}\t\t\t\t\t   fired after control was expanded\n\t search:collapsed\t\t{}\t\t\t\t\t   fired after control was collapsed\n \t search:cancel\t\t\t{}\t\t\t\t\t   fired after cancel button clicked\n\n\tPublic methods:\n\t setLayer()\t\t\t\tL.LayerGroup()         set layer search at runtime\n\t showAlert()            'Text message'         show alert message\n\t searchText()\t\t\t'Text searched'        search text by external code\n*/\n\n//TODO implement can do research on multiple sources layers and remote\t\t\n//TODO history: false,\t\t//show latest searches in tooltip\t\t\n//FIXME option condition problem {autoCollapse: true, markerLocation: true} not show location\n//FIXME option condition problem {autoCollapse: false }\n//\n//TODO here insert function  search inputText FIRST in _recordsCache keys and if not find results.. \n//  run one of callbacks search(sourceData,jsonpUrl or options.layer) and run this.showTooltip\n//\n//TODO change structure of _recordsCache\n//\tlike this: _recordsCache = {\"text-key1\": {loc:[lat,lng], ..other attributes.. }, {\"text-key2\": {loc:[lat,lng]}...}, ...}\n//\tin this mode every record can have a free structure of attributes, only 'loc' is required\n//TODO important optimization!!! always append data in this._recordsCache\n//  now _recordsCache content is emptied and replaced with new data founded\n//  always appending data on _recordsCache give the possibility of caching ajax, jsonp and layersearch!\n//\n//TODO here insert function  search inputText FIRST in _recordsCache keys and if not find results.. \n//  run one of callbacks search(sourceData,jsonpUrl or options.layer) and run this.showTooltip\n//\n//TODO change structure of _recordsCache\n//\tlike this: _recordsCache = {\"text-key1\": {loc:[lat,lng], ..other attributes.. }, {\"text-key2\": {loc:[lat,lng]}...}, ...}\n//\tin this way every record can have a free structure of attributes, only 'loc' is required\n\n(function (factory) {\n    if(typeof define === 'function' && define.amd) {\n    //AMD\n        define(['leaflet'], factory);\n    } else if(typeof module !== 'undefined') {\n    // Node/CommonJS\n        module.exports = factory(require('leaflet'));\n    } else {\n    // Browser globals\n        if(typeof window.L === 'undefined')\n            throw 'Leaflet must be loaded first';\n        factory(window.L);\n    }\n})(function (L) {\n\n\nL.Control.Search = L.Control.extend({\n\t\n\tincludes: L.version[0]==='1' ? L.Evented.prototype : L.Mixin.Events,\n\n\toptions: {\n\t\turl: '',\t\t\t\t\t\t//url for search by ajax request, ex: \"search.php?q={s}\". Can be function to returns string for dynamic parameter setting\n\t\tlayer: null,\t\t\t\t\t//layer where search markers(is a L.LayerGroup)\t\t\t\t\n\t\tsourceData: null,\t\t\t\t//function to fill _recordsCache, passed searching text by first param and callback in second\t\t\t\t\n\t\t//TODO implements uniq option 'sourceData' to recognizes source type: url,array,callback or layer\t\t\t\t\n\t\tjsonpParam: null,\t\t\t\t//jsonp param name for search by jsonp service, ex: \"callback\"\n\t\tpropertyLoc: 'loc',\t\t\t\t//field for remapping location, using array: ['latname','lonname'] for select double fields(ex. ['lat','lon'] ) support dotted format: 'prop.subprop.title'\n\t\tpropertyName: 'title',\t\t\t//property in marker.options(or feature.properties for vector layer) trough filter elements in layer,\n\t\tformatData: null,\t\t\t\t//callback for reformat all data from source to indexed data object\n\t\tfilterData: null,\t\t\t\t//callback for filtering data from text searched, params: textSearch, allRecords\n\t\tmoveToLocation: null,\t\t\t//callback run on location found, params: latlng, title, map\n\t\tbuildTip: null,\t\t\t\t\t//function to return row tip html node(or html string), receive text tooltip in first param\n\t\tcontainer: '',\t\t\t\t\t//container id to insert Search Control\t\t\n\t\tzoom: null,\t\t\t\t\t\t//default zoom level for move to location\n\t\tminLength: 1,\t\t\t\t\t//minimal text length for autocomplete\n\t\tinitial: true,\t\t\t\t\t//search elements only by initial text\n\t\tcasesensitive: false,\t\t\t//search elements in case sensitive text\n\t\tautoType: true,\t\t\t\t\t//complete input with first suggested result and select this filled-in text.\n\t\tdelayType: 400,\t\t\t\t\t//delay while typing for show tooltip\n\t\ttooltipLimit: -1,\t\t\t\t//limit max results to show in tooltip. -1 for no limit, 0 for no results\n\t\ttipAutoSubmit: true,\t\t\t//auto map panTo when click on tooltip\n\t\tfirstTipSubmit: false,\t\t\t//auto select first result con enter click\n\t\tautoResize: true,\t\t\t\t//autoresize on input change\n\t\tcollapsed: true,\t\t\t\t//collapse search control at startup\n\t\tautoCollapse: false,\t\t\t//collapse search control after submit(on button or on tips if enabled tipAutoSubmit)\n\t\tautoCollapseTime: 1200,\t\t\t//delay for autoclosing alert and collapse after blur\n\t\ttextErr: 'Location not found',\t//error message\n\t\ttextCancel: 'Cancel',\t\t    //title in cancel button\t\t\n\t\ttextPlaceholder: 'Search...',   //placeholder value\t\t\t\n\t\thideMarkerOnCollapse: false,    //remove circle and marker on search control collapsed\t\t\n\t\tposition: 'topleft',\t\t\n\t\tmarker: {\t\t\t\t\t\t//custom L.Marker or false for hide\n\t\t\ticon: false,\t\t\t\t//custom L.Icon for maker location or false for hide\n\t\t\tanimate: true,\t\t\t\t//animate a circle over location found\n\t\t\tcircle: {\t\t\t\t\t//draw a circle in location found\n\t\t\t\tradius: 10,\n\t\t\t\tweight: 3,\n\t\t\t\tcolor: '#e03',\n\t\t\t\tstroke: true,\n\t\t\t\tfill: false\n\t\t\t}\n\t\t}\n\t},\n\n\t_getPath: function(obj, prop) {\n\t\tvar parts = prop.split('.'),\n\t\t\tlast = parts.pop(),\n\t\t\tlen = parts.length,\n\t\t\tcur = parts[0],\n\t\t\ti = 1;\n\n\t\tif(len > 0)\n\t\t\twhile((obj = obj[cur]) && i < len)\n\t\t\t\tcur = parts[i++];\n\n\t\tif(obj)\n\t\t\treturn obj[last];\n\t},\n\n\t_isObject: function(obj) {\n\t\treturn Object.prototype.toString.call(obj) === \"[object Object]\";\n\t},\n\n\tinitialize: function(options) {\n\t\tL.Util.setOptions(this, options || {});\n\t\tthis._inputMinSize = this.options.textPlaceholder ? this.options.textPlaceholder.length : 10;\n\t\tthis._layer = this.options.layer || new L.LayerGroup();\n\t\tthis._filterData = this.options.filterData || this._defaultFilterData;\n\t\tthis._formatData = this.options.formatData || this._defaultFormatData;\n\t\tthis._moveToLocation = this.options.moveToLocation || this._defaultMoveToLocation;\n\t\tthis._autoTypeTmp = this.options.autoType;\t//useful for disable autoType temporarily in delete/backspace keydown\n\t\tthis._countertips = 0;\t\t//number of tips items\n\t\tthis._recordsCache = {};\t//key,value table! to store locations! format: key,latlng\n\t\tthis._curReq = null;\n\t},\n\n\tonAdd: function (map) {\n\t\tthis._map = map;\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-search');\n\t\tthis._input = this._createInput(this.options.textPlaceholder, 'search-input');\n\t\tthis._tooltip = this._createTooltip('search-tooltip');\n\t\tthis._cancel = this._createCancel(this.options.textCancel, 'search-cancel');\n\t\tthis._button = this._createButton(this.options.textPlaceholder, 'search-button');\n\t\tthis._alert = this._createAlert('search-alert');\n\n\t\tif(this.options.collapsed===false)\n\t\t\tthis.expand(this.options.collapsed);\n\n\t\tif(this.options.marker) {\n\t\t\t\n\t\t\tif(this.options.marker instanceof L.Marker || this.options.marker instanceof L.CircleMarker)\n\t\t\t\tthis._markerSearch = this.options.marker;\n\n\t\t\telse if(this._isObject(this.options.marker))\n\t\t\t\tthis._markerSearch = new L.Control.Search.Marker([0,0], this.options.marker);\n\n\t\t\tthis._markerSearch._isMarkerSearch = true;\n\t\t}\n\n\t\tthis.setLayer( this._layer );\n\n\t\tmap.on({\n\t\t\t// \t\t'layeradd': this._onLayerAddRemove,\n\t\t\t// \t\t'layerremove': this._onLayerAddRemove\n\t\t\t'resize': this._handleAutoresize\n\t\t\t}, this);\n\t\treturn this._container;\n\t},\n\taddTo: function (map) {\n\n\t\tif(this.options.container) {\n\t\t\tthis._container = this.onAdd(map);\n\t\t\tthis._wrapper = L.DomUtil.get(this.options.container);\n\t\t\tthis._wrapper.style.position = 'relative';\n\t\t\tthis._wrapper.appendChild(this._container);\n\t\t}\n\t\telse\n\t\t\tL.Control.prototype.addTo.call(this, map);\n\n\t\treturn this;\n\t},\n\n\tonRemove: function(map) {\n\t\tthis._recordsCache = {};\n\t\t// map.off({\n\t\t// \t\t'layeradd': this._onLayerAddRemove,\n\t\t// \t\t'layerremove': this._onLayerAddRemove\n\t\t// \t}, this);\n\t\tmap.off({\n\t\t\t// \t\t'layeradd': this._onLayerAddRemove,\n\t\t\t// \t\t'layerremove': this._onLayerAddRemove\n\t\t\t'resize': this._handleAutoresize\n\t\t\t}, this);\n\t},\n\n\t// _onLayerAddRemove: function(e) {\n\t// \t//without this, run setLayer also for each Markers!! to optimize!\n\t// \tif(e.layer instanceof L.LayerGroup)\n\t// \t\tif( L.stamp(e.layer) != L.stamp(this._layer) )\n\t// \t\t\tthis.setLayer(e.layer);\n\t// },\n\n\tsetLayer: function(layer) {\t//set search layer at runtime\n\t\t//this.options.layer = layer; //setting this, run only this._recordsFromLayer()\n\t\tthis._layer = layer;\n\t\tthis._layer.addTo(this._map);\n\t\treturn this;\n\t},\n\t\n\tshowAlert: function(text) {\n\t\tvar self = this;\n\t\ttext = text || this.options.textErr;\n\t\tthis._alert.style.display = 'block';\n\t\tthis._alert.innerHTML = text;\n\t\tclearTimeout(this.timerAlert);\n\t\t\n\t\tthis.timerAlert = setTimeout(function() {\n\t\t\tself.hideAlert();\n\t\t},this.options.autoCollapseTime);\n\t\treturn this;\n\t},\n\t\n\thideAlert: function() {\n\t\tthis._alert.style.display = 'none';\n\t\treturn this;\n\t},\n\t\t\n\tcancel: function() {\n\t\tthis._input.value = '';\n\t\tthis._handleKeypress({ keyCode: 8 });//simulate backspace keypress\n\t\tthis._input.size = this._inputMinSize;\n\t\tthis._input.focus();\n\t\tthis._cancel.style.display = 'none';\n\t\tthis._hideTooltip();\n\t\tthis.fire('search:cancel');\n\t\treturn this;\n\t},\n\t\n\texpand: function(toggle) {\n\t\ttoggle = typeof toggle === 'boolean' ? toggle : true;\n\t\tthis._input.style.display = 'block';\n\t\tL.DomUtil.addClass(this._container, 'search-exp');\n\t\tif ( toggle !== false ) {\n\t\t\tthis._input.focus();\n\t\t\tthis._map.on('dragstart click', this.collapse, this);\n\t\t}\n\t\tthis.fire('search:expanded');\n\t\treturn this;\t\n\t},\n\n\tcollapse: function() {\n\t\tthis._hideTooltip();\n\t\tthis.cancel();\n\t\tthis._alert.style.display = 'none';\n\t\tthis._input.blur();\n\t\tif(this.options.collapsed)\n\t\t{\n\t\t\tthis._input.style.display = 'none';\n\t\t\tthis._cancel.style.display = 'none';\t\t\t\n\t\t\tL.DomUtil.removeClass(this._container, 'search-exp');\t\t\n\t\t\tif (this.options.hideMarkerOnCollapse) {\n\t\t\t\tthis._map.removeLayer(this._markerSearch);\n\t\t\t}\n\t\t\tthis._map.off('dragstart click', this.collapse, this);\n\t\t}\n\t\tthis.fire('search:collapsed');\n\t\treturn this;\n\t},\n\t\n\tcollapseDelayed: function() {\t//collapse after delay, used on_input blur\n\t\tvar self = this;\n\t\tif (!this.options.autoCollapse) return this;\n\t\tclearTimeout(this.timerCollapse);\n\t\tthis.timerCollapse = setTimeout(function() {\n\t\t\tself.collapse();\n\t\t}, this.options.autoCollapseTime);\n\t\treturn this;\t\t\n\t},\n\n\tcollapseDelayedStop: function() {\n\t\tclearTimeout(this.timerCollapse);\n\t\treturn this;\t\t\n\t},\n\n\t////start DOM creations\n\t_createAlert: function(className) {\n\t\tvar alert = L.DomUtil.create('div', className, this._container);\n\t\talert.style.display = 'none';\n\n\t\tL.DomEvent\n\t\t\t.on(alert, 'click', L.DomEvent.stop, this)\n\t\t\t.on(alert, 'click', this.hideAlert, this);\n\n\t\treturn alert;\n\t},\n\n\t_createInput: function (text, className) {\n\t\tvar self = this;\n\t\tvar label = L.DomUtil.create('label', className, this._container);\n\t\tvar input = L.DomUtil.create('input', className, this._container);\n\t\tinput.type = 'text';\n\t\tinput.size = this._inputMinSize;\n\t\tinput.value = '';\n\t\tinput.autocomplete = 'off';\n\t\tinput.autocorrect = 'off';\n\t\tinput.autocapitalize = 'off';\n\t\tinput.placeholder = text;\n\t\tinput.style.display = 'none';\n\t\tinput.role = 'search';\n\t\tinput.id = input.role + input.type + input.size;\n\t\t\n\t\tlabel.htmlFor = input.id;\n\t\tlabel.style.display = 'none';\n\t\tlabel.value = text;\n\n\t\tL.DomEvent\n\t\t\t.disableClickPropagation(input)\n\t\t\t.on(input, 'keyup', this._handleKeypress, this)\n\t\t\t.on(input, 'paste', function(e) {\n\t\t\t\tsetTimeout(function(e) {\n\t\t\t\t\tself._handleKeypress(e);\n\t\t\t\t},10,e);\n\t\t\t}, this)\n\t\t\t.on(input, 'blur', this.collapseDelayed, this)\n\t\t\t.on(input, 'focus', this.collapseDelayedStop, this);\n\t\t\n\t\treturn input;\n\t},\n\n\t_createCancel: function (title, className) {\n\t\tvar cancel = L.DomUtil.create('a', className, this._container);\n\t\tcancel.href = '#';\n\t\tcancel.title = title;\n\t\tcancel.style.display = 'none';\n\t\tcancel.innerHTML = \"<span>&otimes;</span>\";//imageless(see css)\n\n\t\tL.DomEvent\n\t\t\t.on(cancel, 'click', L.DomEvent.stop, this)\n\t\t\t.on(cancel, 'click', this.cancel, this);\n\n\t\treturn cancel;\n\t},\n\t\n\t_createButton: function (title, className) {\n\t\tvar button = L.DomUtil.create('a', className, this._container);\n\t\tbutton.href = '#';\n\t\tbutton.title = title;\n\n\t\tL.DomEvent\n\t\t\t.on(button, 'click', L.DomEvent.stop, this)\n\t\t\t.on(button, 'click', this._handleSubmit, this)\t\t\t\n\t\t\t.on(button, 'focus', this.collapseDelayedStop, this)\n\t\t\t.on(button, 'blur', this.collapseDelayed, this);\n\n\t\treturn button;\n\t},\n\n\t_createTooltip: function(className) {\n\t\tvar self = this;\t\t\n\t\tvar tool = L.DomUtil.create('ul', className, this._container);\n\t\ttool.style.display = 'none';\n\t\tL.DomEvent\n\t\t\t.disableClickPropagation(tool)\n\t\t\t.on(tool, 'blur', this.collapseDelayed, this)\n\t\t\t.on(tool, 'mousewheel', function(e) {\n\t\t\t\tself.collapseDelayedStop();\n\t\t\t\tL.DomEvent.stopPropagation(e);//disable zoom map\n\t\t\t}, this)\n\t\t\t.on(tool, 'mouseover', function(e) {\n\t\t\t\tself.collapseDelayedStop();\n\t\t\t}, this);\n\t\treturn tool;\n\t},\n\n\t_createTip: function(text, val) {//val is object in recordCache, usually is Latlng\n\t\tvar tip;\n\t\t\n\t\tif(this.options.buildTip)\n\t\t{\n\t\t\ttip = this.options.buildTip.call(this, text, val); //custom tip node or html string\n\t\t\tif(typeof tip === 'string')\n\t\t\t{\n\t\t\t\tvar tmpNode = L.DomUtil.create('div');\n\t\t\t\ttmpNode.innerHTML = tip;\n\t\t\t\ttip = tmpNode.firstChild;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttip = L.DomUtil.create('li', '');\n\t\t\ttip.innerHTML = text;\n\t\t}\n\t\t\n\t\tL.DomUtil.addClass(tip, 'search-tip');\n\t\ttip._text = text; //value replaced in this._input and used by _autoType\n\n\t\tif(this.options.tipAutoSubmit)\n\t\t\tL.DomEvent\n\t\t\t\t.disableClickPropagation(tip)\t\t\n\t\t\t\t.on(tip, 'click', L.DomEvent.stop, this)\n\t\t\t\t.on(tip, 'click', function(e) {\n\t\t\t\t\tthis._input.value = text;\n\t\t\t\t\tthis._handleAutoresize();\n\t\t\t\t\tthis._input.focus();\n\t\t\t\t\tthis._hideTooltip();\t\n\t\t\t\t\tthis._handleSubmit();\n\t\t\t\t}, this);\n\n\t\treturn tip;\n\t},\n\n\t//////end DOM creations\n\n\t_getUrl: function(text) {\n\t\treturn (typeof this.options.url === 'function') ? this.options.url(text) : this.options.url;\n\t},\n\n\t_defaultFilterData: function(text, records) {\n\t\n\t\tvar I, icase, regSearch, frecords = {};\n\n\t\ttext = text.replace(/[.*+?^${}()|[\\]\\\\]/g, '');  //sanitize remove all special characters\n\t\tif(text==='')\n\t\t\treturn [];\n\n\t\tI = this.options.initial ? '^' : '';  //search only initial text\n\t\ticase = !this.options.casesensitive ? 'i' : undefined;\n\n\t\tregSearch = new RegExp(I + text, icase);\n\n\t\t//TODO use .filter or .map\n\t\tfor(var key in records) {\n\t\t\tif( regSearch.test(key) )\n\t\t\t\tfrecords[key]= records[key];\n\t\t}\n\t\t\n\t\treturn frecords;\n\t},\n\n\tshowTooltip: function(records) {\n\t\t\n\n\t\tthis._countertips = 0;\n\t\tthis._tooltip.innerHTML = '';\n\t\tthis._tooltip.currentSelection = -1;  //inizialized for _handleArrowSelect()\n\n\t\tif(this.options.tooltipLimit)\n\t\t{\n\t\t\tfor(var key in records)//fill tooltip\n\t\t\t{\n\t\t\t\tif(this._countertips === this.options.tooltipLimit)\n\t\t\t\t\tbreak;\n\t\t\t\t\n\t\t\t\tthis._countertips++;\n\n\t\t\t\tthis._tooltip.appendChild( this._createTip(key, records[key]) );\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(this._countertips > 0)\n\t\t{\n\t\t\tthis._tooltip.style.display = 'block';\n\t\t\t\n\t\t\tif(this._autoTypeTmp)\n\t\t\t\tthis._autoType();\n\n\t\t\tthis._autoTypeTmp = this.options.autoType;//reset default value\n\t\t}\n\t\telse\n\t\t\tthis._hideTooltip();\n\n\t\tthis._tooltip.scrollTop = 0;\n\n\t\treturn this._countertips;\n\t},\n\n\t_hideTooltip: function() {\n\t\tthis._tooltip.style.display = 'none';\n\t\tthis._tooltip.innerHTML = '';\n\t\treturn 0;\n\t},\n\n\t_defaultFormatData: function(json) {\t//default callback for format data to indexed data\n\t\tvar self = this,\n\t\t\tpropName = this.options.propertyName,\n\t\t\tpropLoc = this.options.propertyLoc,\n\t\t\ti, jsonret = {};\n\n\t\tif( L.Util.isArray(propLoc) )\n\t\t\tfor(i in json)\n\t\t\t\tjsonret[ self._getPath(json[i],propName) ]= L.latLng( json[i][ propLoc[0] ], json[i][ propLoc[1] ] );\n\t\telse\n\t\t\tfor(i in json)\n\t\t\t\tjsonret[ self._getPath(json[i],propName) ]= L.latLng( self._getPath(json[i],propLoc) );\n\t\t//TODO throw new Error(\"propertyName '\"+propName+\"' not found in JSON data\");\n\t\treturn jsonret;\n\t},\n\n\t_recordsFromJsonp: function(text, callAfter) {  //extract searched records from remote jsonp service\n\t\tL.Control.Search.callJsonp = callAfter;\n\t\tvar script = L.DomUtil.create('script','leaflet-search-jsonp', document.getElementsByTagName('body')[0] ),\t\t\t\n\t\t\turl = L.Util.template(this._getUrl(text)+'&'+this.options.jsonpParam+'=L.Control.Search.callJsonp', {s: text}); //parsing url\n\t\t\t//rnd = '&_='+Math.floor(Math.random()*10000);\n\t\t\t//TODO add rnd param or randomize callback name! in recordsFromJsonp\n\t\tscript.type = 'text/javascript';\n\t\tscript.src = url;\n\t\treturn { abort: function() { script.parentNode.removeChild(script); } };\n\t},\n\n\t_recordsFromAjax: function(text, callAfter) {\t//Ajax request\n\t\tif (window.XMLHttpRequest === undefined) {\n\t\t\twindow.XMLHttpRequest = function() {\n\t\t\t\ttry { return new ActiveXObject(\"Microsoft.XMLHTTP.6.0\"); }\n\t\t\t\tcatch  (e1) {\n\t\t\t\t\ttry { return new ActiveXObject(\"Microsoft.XMLHTTP.3.0\"); }\n\t\t\t\t\tcatch (e2) { throw new Error(\"XMLHttpRequest is not supported\"); }\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tvar IE8or9 = ( L.Browser.ie && !window.atob && document.querySelector ),\n\t\t\trequest = IE8or9 ? new XDomainRequest() : new XMLHttpRequest(),\n\t\t\turl = L.Util.template(this._getUrl(text), {s: text});\n\n\t\t//rnd = '&_='+Math.floor(Math.random()*10000);\n\t\t//TODO add rnd param or randomize callback name! in recordsFromAjax\t\t\t\n\t\t\n\t\trequest.open(\"GET\", url);\n\t\t\n\n\t\trequest.onload = function() {\n\t\t\tcallAfter( JSON.parse(request.responseText) );\n\t\t};\n\t\trequest.onreadystatechange = function() {\n\t\t    if(request.readyState === 4 && request.status === 200) {\n\t\t    \tthis.onload();\n\t\t    }\n\t\t};\n\n\t\trequest.send();\n\t\treturn request;   \n\t},\n\n  _searchInLayer: function(layer, retRecords, propName) {\n    var self = this, loc;\n\n    if(layer instanceof L.Control.Search.Marker) return;\n\n    if(layer instanceof L.Marker || layer instanceof L.CircleMarker)\n    {\n      if(self._getPath(layer.options,propName))\n      {\n        loc = layer.getLatLng();\n        loc.layer = layer;\n        retRecords[ self._getPath(layer.options,propName) ] = loc;\n      }\n      else if(self._getPath(layer.feature.properties,propName))\n      {\n        loc = layer.getLatLng();\n        loc.layer = layer;\n        retRecords[ self._getPath(layer.feature.properties,propName) ] = loc;\n      }\n      else {\n        //throw new Error(\"propertyName '\"+propName+\"' not found in marker\"); \n         \n      }\n    }\n    else if(layer instanceof L.Path || layer instanceof L.Polyline || layer instanceof L.Polygon)\n    {\n      if(self._getPath(layer.options,propName))\n      {\n        loc = layer.getBounds().getCenter();\n        loc.layer = layer;\n        retRecords[ self._getPath(layer.options,propName) ] = loc;\n      }\n      else if(self._getPath(layer.feature.properties,propName))\n      {\n        loc = layer.getBounds().getCenter();\n        loc.layer = layer;\n        retRecords[ self._getPath(layer.feature.properties,propName) ] = loc;\n      }\n      else {\n        //throw new Error(\"propertyName '\"+propName+\"' not found in shape\"); \n         \n      }\n    }\n    else if(layer.hasOwnProperty('feature'))//GeoJSON\n    {\n      if(layer.feature.properties.hasOwnProperty(propName))\n      {\n        if(layer.getLatLng && typeof layer.getLatLng === 'function') {\n          loc = layer.getLatLng();\n          loc.layer = layer;\t\t\t\n          retRecords[ layer.feature.properties[propName] ] = loc;\n        } else if(layer.getBounds && typeof layer.getBounds === 'function') {\n          loc = layer.getBounds().getCenter();\n          loc.layer = layer;\t\t\t\n          retRecords[ layer.feature.properties[propName] ] = loc;\n        } else {\n          \n        }\n      }\n      else {\n        //throw new Error(\"propertyName '\"+propName+\"' not found in feature\");\n         \n      }\n    }\n    else if(layer instanceof L.LayerGroup)\n    {\n      layer.eachLayer(function (layer) {\n        self._searchInLayer(layer, retRecords, propName);\n      });\n    }\n  },\n\t\n\t_recordsFromLayer: function() {\t//return table: key,value from layer\n\t\tvar self = this,\n\t\t\tretRecords = {},\n\t\t\tpropName = this.options.propertyName;\n\t\t\n\t\tthis._layer.eachLayer(function (layer) {\n\t\t\tself._searchInLayer(layer, retRecords, propName);\n\t\t});\n\t\t\n\t\treturn retRecords;\n\t},\n\t\n\t_autoType: function() {\n\t\t\n\t\t//TODO implements autype without selection(useful for mobile device)\n\t\t\n\t\tvar start = this._input.value.length,\n\t\t\tfirstRecord = this._tooltip.firstChild ? this._tooltip.firstChild._text : '',\n\t\t\tend = firstRecord.length;\n\n\t\tif (firstRecord.indexOf(this._input.value) === 0) { // If prefix match\n\t\t\tthis._input.value = firstRecord;\n\t\t\tthis._handleAutoresize();\n\n\t\t\tif (this._input.createTextRange) {\n\t\t\t\tvar selRange = this._input.createTextRange();\n\t\t\t\tselRange.collapse(true);\n\t\t\t\tselRange.moveStart('character', start);\n\t\t\t\tselRange.moveEnd('character', end);\n\t\t\t\tselRange.select();\n\t\t\t}\n\t\t\telse if(this._input.setSelectionRange) {\n\t\t\t\tthis._input.setSelectionRange(start, end);\n\t\t\t}\n\t\t\telse if(this._input.selectionStart) {\n\t\t\t\tthis._input.selectionStart = start;\n\t\t\t\tthis._input.selectionEnd = end;\n\t\t\t}\n\t\t}\n\t},\n\n\t_hideAutoType: function() {\t// deselect text:\n\n\t\tvar sel;\n\t\tif ((sel = this._input.selection) && sel.empty) {\n\t\t\tsel.empty();\n\t\t}\n\t\telse if (this._input.createTextRange) {\n\t\t\tsel = this._input.createTextRange();\n\t\t\tsel.collapse(true);\n\t\t\tvar end = this._input.value.length;\n\t\t\tsel.moveStart('character', end);\n\t\t\tsel.moveEnd('character', end);\n\t\t\tsel.select();\n\t\t}\n\t\telse {\n\t\t\tif (this._input.getSelection) {\n\t\t\t\tthis._input.getSelection().removeAllRanges();\n\t\t\t}\n\t\t\tthis._input.selectionStart = this._input.selectionEnd;\n\t\t}\n\t},\n\t\n\t_handleKeypress: function (e) {\t//run _input keyup event\n\t\tvar self = this;\n\n\t\tswitch(e.keyCode)\n\t\t{\n\t\t\tcase 27://Esc\n\t\t\t\tthis.collapse();\n\t\t\tbreak;\n\t\t\tcase 13://Enter\n\t\t\t\tif(this._countertips == 1 || (this.options.firstTipSubmit && this._countertips > 0)) {\n          \t\t\tif(this._tooltip.currentSelection == -1) {\n\t\t\t\t\t\tthis._handleArrowSelect(1);\n          \t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._handleSubmit();\t//do search\n\t\t\tbreak;\n\t\t\tcase 38://Up\n\t\t\t\tthis._handleArrowSelect(-1);\n\t\t\tbreak;\n\t\t\tcase 40://Down\n\t\t\t\tthis._handleArrowSelect(1);\n\t\t\tbreak;\n\t\t\tcase  8://Backspace\n\t\t\tcase 45://Insert\n\t\t\tcase 46://Delete\n\t\t\t\tthis._autoTypeTmp = false;//disable temporarily autoType\n\t\t\tbreak;\n\t\t\tcase 37://Left\n\t\t\tcase 39://Right\n\t\t\tcase 16://Shift\n\t\t\tcase 17://Ctrl\n\t\t\tcase 35://End\n\t\t\tcase 36://Home\n\t\t\tbreak;\n\t\t\tdefault://All keys\n\t\t\t\tif(this._input.value.length)\n\t\t\t\t\tthis._cancel.style.display = 'block';\n\t\t\t\telse\n\t\t\t\t\tthis._cancel.style.display = 'none';\n\n\t\t\t\tif(this._input.value.length >= this.options.minLength)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.timerKeypress);\t//cancel last search request while type in\t\t\t\t\n\t\t\t\t\tthis.timerKeypress = setTimeout(function() {\t//delay before request, for limit jsonp/ajax request\n\n\t\t\t\t\t\tself._fillRecordsCache();\n\t\t\t\t\t\n\t\t\t\t\t}, this.options.delayType);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis._hideTooltip();\n\t\t}\n\n\t\tthis._handleAutoresize();\n\t},\n\n\tsearchText: function(text) {\n\t\tvar code = text.charCodeAt(text.length);\n\n\t\tthis._input.value = text;\n\n\t\tthis._input.style.display = 'block';\n\t\tL.DomUtil.addClass(this._container, 'search-exp');\n\n\t\tthis._autoTypeTmp = false;\n\n\t\tthis._handleKeypress({keyCode: code});\n\t},\n\t\n\t_fillRecordsCache: function() {\n\n\t\tvar self = this,\n\t\t\tinputText = this._input.value, records;\n\n\t\tif(this._curReq && this._curReq.abort)\n\t\t\tthis._curReq.abort();\n\t\t//abort previous requests\n\n\t\tL.DomUtil.addClass(this._container, 'search-load');\t\n\n\t\tif(this._layer)\n\t\t{\n\t\t\t//TODO _recordsFromLayer must return array of objects, formatted from _formatData\n\t\t\tthis._recordsCache = this._recordsFromLayer();\n\t\t\t\n\t\t\trecords = this._filterData( this._input.value, this._recordsCache );\n\n\t\t\tthis.showTooltip( records );\n\n\t\t\tL.DomUtil.removeClass(this._container, 'search-load');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(this.options.sourceData)\n\t\t\t\tthis._retrieveData = this.options.sourceData;\n\n\t\t\telse if(this.options.url)\t//jsonp or ajax\n\t\t\t\tthis._retrieveData = this.options.jsonpParam ? this._recordsFromJsonp : this._recordsFromAjax;\n\n\t\t\tthis._curReq = this._retrieveData.call(this, inputText, function(data) {\n\t\t\t\t\n\t\t\t\tself._recordsCache = self._formatData.call(self, data);\n\n\t\t\t\t//TODO refact!\n\t\t\t\tif(self.options.sourceData)\n\t\t\t\t\trecords = self._filterData( self._input.value, self._recordsCache );\n\t\t\t\telse\n\t\t\t\t\trecords = self._recordsCache;\n\n\t\t\t\tself.showTooltip( records );\n \n\t\t\t\tL.DomUtil.removeClass(self._container, 'search-load');\n\t\t\t});\n\t\t}\n\t},\n\t\n\t_handleAutoresize: function() {\n\t    var maxWidth;\n\n\t\tif (this._input.style.maxWidth !== this._map._container.offsetWidth) {\n\t\t\tmaxWidth = this._map._container.clientWidth;\n\n\t\t\t// other side margin + padding + width border + width search-button + width search-cancel\n\t\t\tmaxWidth -= 10 + 20 + 1 + 30 + 22; \n\n\t\t\tthis._input.style.maxWidth = maxWidth.toString() + 'px';\n\t\t}\n\n\t\tif (this.options.autoResize && (this._container.offsetWidth + 20 < this._map._container.offsetWidth)) {\n\t\t\tthis._input.size = this._input.value.length < this._inputMinSize ? this._inputMinSize : this._input.value.length;\n\t\t}\n\t},\n\n\t_handleArrowSelect: function(velocity) {\n\t\n\t\tvar searchTips = this._tooltip.hasChildNodes() ? this._tooltip.childNodes : [];\n\t\t\t\n\t\tfor (i=0; i<searchTips.length; i++)\n\t\t\tL.DomUtil.removeClass(searchTips[i], 'search-tip-select');\n\t\t\n\t\tif ((velocity == 1 ) && (this._tooltip.currentSelection >= (searchTips.length - 1))) {// If at end of list.\n\t\t\tL.DomUtil.addClass(searchTips[this._tooltip.currentSelection], 'search-tip-select');\n\t\t}\n\t\telse if ((velocity == -1 ) && (this._tooltip.currentSelection <= 0)) { // Going back up to the search box.\n\t\t\tthis._tooltip.currentSelection = -1;\n\t\t}\n\t\telse if (this._tooltip.style.display != 'none') {\n\t\t\tthis._tooltip.currentSelection += velocity;\n\t\t\t\n\t\t\tL.DomUtil.addClass(searchTips[this._tooltip.currentSelection], 'search-tip-select');\n\t\t\t\n\t\t\tthis._input.value = searchTips[this._tooltip.currentSelection]._text;\n\n\t\t\t// scroll:\n\t\t\tvar tipOffsetTop = searchTips[this._tooltip.currentSelection].offsetTop;\n\t\t\t\n\t\t\tif (tipOffsetTop + searchTips[this._tooltip.currentSelection].clientHeight >= this._tooltip.scrollTop + this._tooltip.clientHeight) {\n\t\t\t\tthis._tooltip.scrollTop = tipOffsetTop - this._tooltip.clientHeight + searchTips[this._tooltip.currentSelection].clientHeight;\n\t\t\t}\n\t\t\telse if (tipOffsetTop <= this._tooltip.scrollTop) {\n\t\t\t\tthis._tooltip.scrollTop = tipOffsetTop;\n\t\t\t}\n\t\t}\n\t},\n\n\t_handleSubmit: function() {\t//button and tooltip click and enter submit\n\n\t\tthis._hideAutoType();\n\t\t\n\t\tthis.hideAlert();\n\t\tthis._hideTooltip();\n\n\t\tif(this._input.style.display == 'none')\t//on first click show _input only\n\t\t\tthis.expand();\n\t\telse\n\t\t{\n\t\t\tif(this._input.value === '')\t//hide _input only\n\t\t\t\tthis.collapse();\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar loc = this._getLocation(this._input.value);\n\t\t\t\t\n\t\t\t\tif(loc===false)\n\t\t\t\t\tthis.showAlert();\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.showLocation(loc, this._input.value);\n\t\t\t\t\tthis.fire('search:locationfound', {\n\t\t\t\t\t\t\tlatlng: loc,\n\t\t\t\t\t\t\ttext: this._input.value,\n\t\t\t\t\t\t\tlayer: loc.layer ? loc.layer : null\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t_getLocation: function(key) {\t//extract latlng from _recordsCache\n\n\t\tif( this._recordsCache.hasOwnProperty(key) )\n\t\t\treturn this._recordsCache[key];//then after use .loc attribute\n\t\telse\n\t\t\treturn false;\n\t},\n\n\t_defaultMoveToLocation: function(latlng, title, map) {\n\t\tif(this.options.zoom)\n \t\t\tthis._map.setView(latlng, this.options.zoom);\n \t\telse\n\t\t\tthis._map.panTo(latlng);\n\t},\n\n\tshowLocation: function(latlng, title) {\t//set location on map from _recordsCache\n\t\tvar self = this;\n\n\t\tself._map.once('moveend zoomend', function(e) {\n\n\t\t\tif(self._markerSearch) {\n\t\t\t\tself._markerSearch.addTo(self._map).setLatLng(latlng);\n\t\t\t}\n\t\t\t\n\t\t});\n\n\t\tself._moveToLocation(latlng, title, self._map);\n\t\t//FIXME autoCollapse option hide self._markerSearch before visualized!!\n\t\tif(self.options.autoCollapse)\n\t\t\tself.collapse();\n\n\t\treturn self;\n\t}\n});\n\nL.Control.Search.Marker = L.Marker.extend({\n\n\tincludes: L.version[0]==='1' ? L.Evented.prototype : L.Mixin.Events,\n\t\n\toptions: {\n\t\ticon: new L.Icon.Default(),\n\t\tanimate: true,\n\t\tcircle: {\n\t\t\tradius: 10,\n\t\t\tweight: 3,\n\t\t\tcolor: '#e03',\n\t\t\tstroke: true,\n\t\t\tfill: false\n\t\t}\n\t},\n\t\n\tinitialize: function (latlng, options) {\n\t\tL.setOptions(this, options);\n\n\t\tif(options.icon === true)\n\t\t\toptions.icon = new L.Icon.Default();\n\n\t\tL.Marker.prototype.initialize.call(this, latlng, options);\n\t\t\n\t\tif( L.Control.Search.prototype._isObject(this.options.circle) )\n\t\t\tthis._circleLoc = new L.CircleMarker(latlng, this.options.circle);\n\t},\n\n\tonAdd: function (map) {\n\t\tL.Marker.prototype.onAdd.call(this, map);\n\t\tif(this._circleLoc) {\n\t\t\tmap.addLayer(this._circleLoc);\n\t\t\tif(this.options.animate)\n\t\t\t\tthis.animate();\n\t\t}\n\t},\n\n\tonRemove: function (map) {\n\t\tL.Marker.prototype.onRemove.call(this, map);\n\t\tif(this._circleLoc)\n\t\t\tmap.removeLayer(this._circleLoc);\n\t},\n\t\n\tsetLatLng: function (latlng) {\n\t\tL.Marker.prototype.setLatLng.call(this, latlng);\n\t\tif(this._circleLoc)\n\t\t\tthis._circleLoc.setLatLng(latlng);\n\t\treturn this;\n\t},\n\t\n\t_initIcon: function () {\n\t\tif(this.options.icon)\n\t\t\tL.Marker.prototype._initIcon.call(this);\n\t},\n\n\t_removeIcon: function () {\n\t\tif(this.options.icon)\n\t\t\tL.Marker.prototype._removeIcon.call(this);\n\t},\n\n\tanimate: function() {\n\t//TODO refact animate() more smooth! like this: http://goo.gl/DDlRs\n\t\tif(this._circleLoc)\n\t\t{\n\t\t\tvar circle = this._circleLoc,\n\t\t\t\ttInt = 200,\t//time interval\n\t\t\t\tss = 5,\t//frames\n\t\t\t\tmr = parseInt(circle._radius/ss),\n\t\t\t\toldrad = this.options.circle.radius,\n\t\t\t\tnewrad = circle._radius * 2,\n\t\t\t\tacc = 0;\n\n\t\t\tcircle._timerAnimLoc = setInterval(function() {\n\t\t\t\tacc += 0.5;\n\t\t\t\tmr += acc;\t//adding acceleration\n\t\t\t\tnewrad -= mr;\n\t\t\t\t\n\t\t\t\tcircle.setRadius(newrad);\n\n\t\t\t\tif(newrad<oldrad)\n\t\t\t\t{\n\t\t\t\t\tclearInterval(circle._timerAnimLoc);\n\t\t\t\t\tcircle.setRadius(oldrad);//reset radius\n\t\t\t\t\t//if(typeof afterAnimCall == 'function')\n\t\t\t\t\t\t//afterAnimCall();\n\t\t\t\t\t\t//TODO use create event 'animateEnd' in L.Control.Search.Marker \n\t\t\t\t}\n\t\t\t}, tInt);\n\t\t}\n\t\t\n\t\treturn this;\n\t}\n});\n\nL.Map.addInitHook(function () {\n    if (this.options.searchControl) {\n        this.searchControl = L.control.search(this.options.searchControl);\n        this.addControl(this.searchControl);\n    }\n});\n\nL.control.search = function (options) {\n    return new L.Control.Search(options);\n};\n\nreturn L.Control.Search;\n\n});\n\n\n"],"sourceRoot":""}